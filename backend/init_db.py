"""
数据库初始化脚本 - 创建表并插入内置300词
"""
import sys
import os
sys.path.append(os.path.dirname(os.path.dirname(__file__)))

from app.database import engine, SessionLocal
from app.models import Base, Word, Progress

# 内置300词词库数据
INITIAL_WORDS = [
    # 日常高频词（100词）- 难度1
    ("hello", "你好", 1, "日常高频"),
    ("goodbye", "再见", 1, "日常高频"),
    ("thanks", "谢谢", 1, "日常高频"),
    ("please", "请", 1, "日常高频"),
    ("sorry", "对不起", 1, "日常高频"),
    ("yes", "是", 1, "日常高频"),
    ("no", "不", 1, "日常高频"),
    ("water", "水", 1, "日常高频"),
    ("food", "食物", 1, "日常高频"),
    ("time", "时间", 1, "日常高频"),
    ("day", "天", 1, "日常高频"),
    ("night", "夜晚", 1, "日常高频"),
    ("morning", "早晨", 1, "日常高频"),
    ("evening", "傍晚", 1, "日常高频"),
    ("year", "年", 1, "日常高频"),
    ("month", "月", 1, "日常高频"),
    ("week", "周", 1, "日常高频"),
    ("today", "今天", 1, "日常高频"),
    ("tomorrow", "明天", 1, "日常高频"),
    ("yesterday", "昨天", 1, "日常高频"),
    ("home", "家", 1, "日常高频"),
    ("school", "学校", 1, "日常高频"),
    ("work", "工作", 1, "日常高频"),
    ("friend", "朋友", 1, "日常高频"),
    ("family", "家庭", 1, "日常高频"),
    ("love", "爱", 1, "日常高频"),
    ("happy", "快乐的", 1, "日常高频"),
    ("sad", "悲伤的", 1, "日常高频"),
    ("good", "好的", 1, "日常高频"),
    ("bad", "坏的", 1, "日常高频"),
    ("big", "大的", 1, "日常高频"),
    ("small", "小的", 1, "日常高频"),
    ("hot", "热的", 1, "日常高频"),
    ("cold", "冷的", 1, "日常高频"),
    ("new", "新的", 1, "日常高频"),
    ("old", "旧的", 1, "日常高频"),
    ("eat", "吃", 1, "日常高频"),
    ("drink", "喝", 1, "日常高频"),
    ("sleep", "睡觉", 1, "日常高频"),
    ("walk", "走路", 1, "日常高频"),
    ("run", "跑", 1, "日常高频"),
    ("read", "阅读", 1, "日常高频"),
    ("write", "写", 1, "日常高频"),
    ("speak", "说话", 1, "日常高频"),
    ("listen", "听", 1, "日常高频"),
    ("see", "看见", 1, "日常高频"),
    ("watch", "观看", 1, "日常高频"),
    ("look", "看", 1, "日常高频"),
    ("come", "来", 1, "日常高频"),
    ("go", "去", 1, "日常高频"),
    ("take", "拿", 1, "日常高频"),
    ("give", "给", 1, "日常高频"),
    ("make", "制作", 1, "日常高频"),
    ("get", "得到", 1, "日常高频"),
    ("know", "知道", 1, "日常高频"),
    ("think", "思考", 1, "日常高频"),
    ("want", "想要", 1, "日常高频"),
    ("need", "需要", 1, "日常高频"),
    ("like", "喜欢", 1, "日常高频"),
    ("use", "使用", 1, "日常高频"),
    ("find", "找到", 1, "日常高频"),
    ("call", "打电话", 1, "日常高频"),
    ("try", "尝试", 1, "日常高频"),
    ("help", "帮助", 1, "日常高频"),
    ("ask", "问", 1, "日常高频"),
    ("tell", "告诉", 1, "日常高频"),
    ("play", "玩", 1, "日常高频"),
    ("study", "学习", 1, "日常高频"),
    ("teach", "教", 1, "日常高频"),
    ("learn", "学习", 1, "日常高频"),
    ("start", "开始", 1, "日常高频"),
    ("stop", "停止", 1, "日常高频"),
    ("open", "打开", 1, "日常高频"),
    ("close", "关闭", 1, "日常高频"),
    ("buy", "买", 1, "日常高频"),
    ("sell", "卖", 1, "日常高频"),
    ("pay", "支付", 1, "日常高频"),
    ("cost", "花费", 1, "日常高频"),
    ("phone", "电话", 1, "日常高频"),
    ("book", "书", 1, "日常高频"),
    ("car", "汽车", 1, "日常高频"),
    ("house", "房子", 1, "日常高频"),
    ("door", "门", 1, "日常高频"),
    ("window", "窗户", 1, "日常高频"),
    ("table", "桌子", 1, "日常高频"),
    ("chair", "椅子", 1, "日常高频"),
    ("bed", "床", 1, "日常高频"),
    ("room", "房间", 1, "日常高频"),
    ("street", "街道", 1, "日常高频"),
    ("city", "城市", 1, "日常高频"),
    ("country", "国家", 1, "日常高频"),
    ("world", "世界", 1, "日常高频"),
    ("sun", "太阳", 1, "日常高频"),
    ("moon", "月亮", 1, "日常高频"),
    ("star", "星星", 1, "日常高频"),
    ("tree", "树", 1, "日常高频"),
    ("flower", "花", 1, "日常高频"),
    ("grass", "草", 1, "日常高频"),
    
    # 考试核心词（100词）- 难度2
    ("analyze", "分析", 2, "考试核心"),
    ("benefit", "好处;有益于", 2, "考试核心"),
    ("challenge", "挑战", 2, "考试核心"),
    ("develop", "发展", 2, "考试核心"),
    ("environment", "环境", 2, "考试核心"),
    ("factor", "因素", 2, "考试核心"),
    ("generate", "产生", 2, "考试核心"),
    ("identify", "识别", 2, "考试核心"),
    ("individual", "个人的", 2, "考试核心"),
    ("method", "方法", 2, "考试核心"),
    ("significant", "重要的", 2, "考试核心"),
    ("theory", "理论", 2, "考试核心"),
    ("approach", "方法;接近", 2, "考试核心"),
    ("concept", "概念", 2, "考试核心"),
    ("create", "创造", 2, "考试核心"),
    ("indicate", "表明", 2, "考试核心"),
    ("process", "过程", 2, "考试核心"),
    ("require", "需要", 2, "考试核心"),
    ("structure", "结构", 2, "考试核心"),
    ("achieve", "达到", 2, "考试核心"),
    ("available", "可用的", 2, "考试核心"),
    ("consist", "组成", 2, "考试核心"),
    ("economy", "经济", 2, "考试核心"),
    ("establish", "建立", 2, "考试核心"),
    ("function", "功能", 2, "考试核心"),
    ("involve", "涉及", 2, "考试核心"),
    ("occur", "发生", 2, "考试核心"),
    ("principle", "原则", 2, "考试核心"),
    ("respond", "回应", 2, "考试核心"),
    ("role", "角色", 2, "考试核心"),
    ("section", "部分", 2, "考试核心"),
    ("similar", "相似的", 2, "考试核心"),
    ("source", "来源", 2, "考试核心"),
    ("specific", "具体的", 2, "考试核心"),
    ("strategy", "策略", 2, "考试核心"),
    ("assume", "假设", 2, "考试核心"),
    ("authority", "权威", 2, "考试核心"),
    ("community", "社区", 2, "考试核心"),
    ("constitute", "构成", 2, "考试核心"),
    ("contract", "合同", 2, "考试核心"),
    ("distribute", "分配", 2, "考试核心"),
    ("estimate", "估计", 2, "考试核心"),
    ("evidence", "证据", 2, "考试核心"),
    ("export", "出口", 2, "考试核心"),
    ("initial", "最初的", 2, "考试核心"),
    ("instance", "实例", 2, "考试核心"),
    ("legal", "法律的", 2, "考试核心"),
    ("legislate", "立法", 2, "考试核心"),
    ("maintain", "维持", 2, "考试核心"),
    ("normal", "正常的", 2, "考试核心"),
    ("obtain", "获得", 2, "考试核心"),
    ("percent", "百分比", 2, "考试核心"),
    ("period", "时期", 2, "考试核心"),
    ("policy", "政策", 2, "考试核心"),
    ("previous", "先前的", 2, "考试核心"),
    ("primary", "主要的", 2, "考试核心"),
    ("purchase", "购买", 2, "考试核心"),
    ("range", "范围", 2, "考试核心"),
    ("region", "地区", 2, "考试核心"),
    ("regulate", "调节", 2, "考试核心"),
    ("relevant", "相关的", 2, "考试核心"),
    ("resident", "居民", 2, "考试核心"),
    ("resource", "资源", 2, "考试核心"),
    ("restrict", "限制", 2, "考试核心"),
    ("secure", "安全的", 2, "考试核心"),
    ("seek", "寻求", 2, "考试核心"),
    ("select", "选择", 2, "考试核心"),
    ("site", "地点", 2, "考试核心"),
    ("survey", "调查", 2, "考试核心"),
    ("text", "文本", 2, "考试核心"),
    ("transfer", "转移", 2, "考试核心"),
    ("tradition", "传统", 2, "考试核心"),
    ("vary", "变化", 2, "考试核心"),
    ("achieve", "实现", 2, "考试核心"),
    ("affect", "影响", 2, "考试核心"),
    ("appropriate", "适当的", 2, "考试核心"),
    ("aspect", "方面", 2, "考试核心"),
    ("assist", "协助", 2, "考试核心"),
    ("category", "类别", 2, "考试核心"),
    ("chapter", "章节", 2, "考试核心"),
    ("commission", "委员会", 2, "考试核心"),
    ("complex", "复杂的", 2, "考试核心"),
    ("compute", "计算", 2, "考试核心"),
    ("conclude", "得出结论", 2, "考试核心"),
    ("conduct", "进行", 2, "考试核心"),
    ("consequent", "随之发生的", 2, "考试核心"),
    ("considerable", "相当大的", 2, "考试核心"),
    ("consist", "由...组成", 2, "考试核心"),
    ("constant", "不断的", 2, "考试核心"),
    ("context", "背景", 2, "考试核心"),
    ("contribute", "贡献", 2, "考试核心"),
    ("coordinate", "协调", 2, "考试核心"),
    ("corporate", "公司的", 2, "考试核心"),
    ("correspond", "符合", 2, "考试核心"),
    ("criteria", "标准", 2, "考试核心"),
    ("data", "数据", 2, "考试核心"),
    ("define", "定义", 2, "考试核心"),
    ("demonstrate", "证明", 2, "考试核心"),
    ("derive", "得出", 2, "考试核心"),
    
    # 兴趣主题词（100词）- 难度1-3混合
    # 动物类
    ("cat", "猫", 1, "动物"),
    ("dog", "狗", 1, "动物"),
    ("bird", "鸟", 1, "动物"),
    ("fish", "鱼", 1, "动物"),
    ("tiger", "老虎", 1, "动物"),
    ("lion", "狮子", 1, "动物"),
    ("elephant", "大象", 2, "动物"),
    ("monkey", "猴子", 1, "动物"),
    ("rabbit", "兔子", 1, "动物"),
    ("horse", "马", 1, "动物"),
    ("cow", "牛", 1, "动物"),
    ("sheep", "羊", 1, "动物"),
    ("pig", "猪", 1, "动物"),
    ("chicken", "鸡", 1, "动物"),
    ("duck", "鸭子", 1, "动物"),
    ("bear", "熊", 1, "动物"),
    ("wolf", "狼", 1, "动物"),
    ("fox", "狐狸", 1, "动物"),
    ("panda", "熊猫", 1, "动物"),
    ("kangaroo", "袋鼠", 2, "动物"),
    ("giraffe", "长颈鹿", 2, "动物"),
    ("zebra", "斑马", 1, "动物"),
    ("penguin", "企鹅", 2, "动物"),
    ("dolphin", "海豚", 2, "动物"),
    ("whale", "鲸鱼", 1, "动物"),
    ("shark", "鲨鱼", 1, "动物"),
    ("snake", "蛇", 1, "动物"),
    ("turtle", "乌龟", 1, "动物"),
    ("frog", "青蛙", 1, "动物"),
    ("butterfly", "蝴蝶", 2, "动物"),
    ("bee", "蜜蜂", 1, "动物"),
    ("ant", "蚂蚁", 1, "动物"),
    ("spider", "蜘蛛", 1, "动物"),
    
    # 食物类
    ("apple", "苹果", 1, "食物"),
    ("banana", "香蕉", 1, "食物"),
    ("orange", "橙子", 1, "食物"),
    ("grape", "葡萄", 1, "食物"),
    ("strawberry", "草莓", 2, "食物"),
    ("watermelon", "西瓜", 2, "食物"),
    ("pear", "梨", 1, "食物"),
    ("peach", "桃子", 1, "食物"),
    ("cherry", "樱桃", 1, "食物"),
    ("lemon", "柠檬", 1, "食物"),
    ("bread", "面包", 1, "食物"),
    ("rice", "米饭", 1, "食物"),
    ("noodle", "面条", 1, "食物"),
    ("pizza", "披萨", 1, "食物"),
    ("hamburger", "汉堡", 2, "食物"),
    ("sandwich", "三明治", 2, "食物"),
    ("salad", "沙拉", 1, "食物"),
    ("soup", "汤", 1, "食物"),
    ("meat", "肉", 1, "食物"),
    ("beef", "牛肉", 1, "食物"),
    ("pork", "猪肉", 1, "食物"),
    ("chicken", "鸡肉", 1, "食物"),
    ("egg", "鸡蛋", 1, "食物"),
    ("milk", "牛奶", 1, "食物"),
    ("cheese", "奶酪", 1, "食物"),
    ("butter", "黄油", 1, "食物"),
    ("sugar", "糖", 1, "食物"),
    ("salt", "盐", 1, "食物"),
    ("coffee", "咖啡", 1, "食物"),
    ("tea", "茶", 1, "食物"),
    ("juice", "果汁", 1, "食物"),
    ("cake", "蛋糕", 1, "食物"),
    ("cookie", "饼干", 1, "食物"),
    ("chocolate", "巧克力", 2, "食物"),
    
    # 科技类
    ("computer", "电脑", 2, "科技"),
    ("internet", "互联网", 2, "科技"),
    ("software", "软件", 2, "科技"),
    ("hardware", "硬件", 2, "科技"),
    ("keyboard", "键盘", 2, "科技"),
    ("mouse", "鼠标", 1, "科技"),
    ("screen", "屏幕", 1, "科技"),
    ("email", "电子邮件", 1, "科技"),
    ("website", "网站", 2, "科技"),
    ("download", "下载", 2, "科技"),
    ("upload", "上传", 2, "科技"),
    ("network", "网络", 2, "科技"),
    ("database", "数据库", 3, "科技"),
    ("program", "程序", 2, "科技"),
    ("application", "应用程序", 3, "科技"),
    ("smartphone", "智能手机", 2, "科技"),
    ("tablet", "平板电脑", 2, "科技"),
    ("laptop", "笔记本电脑", 2, "科技"),
    ("desktop", "台式电脑", 2, "科技"),
    ("robot", "机器人", 2, "科技"),
    ("artificial", "人工的", 3, "科技"),
    ("intelligence", "智能", 3, "科技"),
    ("technology", "技术", 3, "科技"),
    ("digital", "数字的", 2, "科技"),
    ("virtual", "虚拟的", 2, "科技"),
    ("reality", "现实", 2, "科技"),
    ("battery", "电池", 2, "科技"),
    ("charge", "充电", 1, "科技"),
    ("wireless", "无线的", 2, "科技"),
    ("bluetooth", "蓝牙", 2, "科技"),
    ("cloud", "云", 1, "科技"),
    ("storage", "存储", 2, "科技"),
    ("security", "安全", 3, "科技"),
    
    # 补充高级词汇（难度3） - 至少100个
    ("accommodate", "容纳；提供住宿", 3, "考试核心"),
    ("accompany", "陪伴", 3, "考试核心"),
    ("accumulate", "积累", 3, "考试核心"),
    ("acknowledge", "承认；致谢", 3, "考试核心"),
    ("adequate", "足够的；适当的", 3, "考试核心"),
    ("adjacent", "邻近的", 3, "考试核心"),
    ("advocate", "提倡；拥护", 3, "考试核心"),
    ("affiliate", "使隶属", 3, "考试核心"),
    ("aggregate", "总计；聚集", 3, "考试核心"),
    ("allocate", "分配", 3, "考试核心"),
    ("ambiguous", "模糊的", 3, "考试核心"),
    ("amplify", "放大", 3, "考试核心"),
    ("analogy", "类比", 3, "考试核心"),
    ("anticipate", "预期", 3, "考试核心"),
    ("arbitrary", "任意的；武断的", 3, "考试核心"),
    ("articulate", "清晰表达", 3, "考试核心"),
    ("assemble", "组装；集合", 3, "考试核心"),
    ("attribute", "归因于；特征", 3, "考试核心"),
    ("authentic", "真实的", 3, "考试核心"),
    ("autonomous", "自主的", 3, "考试核心"),
    ("capacity", "容量；能力", 3, "考试核心"),
    ("catastrophe", "灾难", 3, "考试核心"),
    ("chronological", "按时间顺序的", 3, "考试核心"),
    ("clarify", "澄清", 3, "考试核心"),
    ("coherent", "连贯的", 3, "考试核心"),
    ("collaborate", "合作", 3, "考试核心"),
    ("commence", "开始", 3, "考试核心"),
    ("compatible", "兼容的", 3, "考试核心"),
    ("compensate", "补偿", 3, "考试核心"),
    ("compile", "编译；汇编", 3, "考试核心"),
    ("complement", "补充", 3, "考试核心"),
    ("comprehensive", "全面的", 3, "考试核心"),
    ("conceive", "构想；怀孕", 3, "考试核心"),
    ("concurrent", "同时发生的", 3, "考试核心"),
    ("constitute", "构成", 3, "考试核心"),
    ("contemplate", "沉思", 3, "考试核心"),
    ("contemporary", "当代的", 3, "考试核心"),
    ("contradict", "矛盾；反驳", 3, "考试核心"),
    ("controversy", "争议", 3, "考试核心"),
    ("convey", "传达", 3, "考试核心"),
    ("correlate", "相关", 3, "考试核心"),
    ("criterion", "标准", 3, "考试核心"),
    ("crucial", "关键的", 3, "考试核心"),
    ("cumulative", "累积的", 3, "考试核心"),
    ("deliberate", "故意的；仔细考虑", 3, "考试核心"),
    ("denote", "表示", 3, "考试核心"),
    ("depict", "描绘", 3, "考试核心"),
    ("derive", "得出；源于", 3, "考试核心"),
    ("deteriorate", "恶化", 3, "考试核心"),
    ("deviate", "偏离", 3, "考试核心"),
    ("differentiate", "区分", 3, "考试核心"),
    ("diminish", "减少", 3, "考试核心"),
    ("discrete", "离散的；分离的", 3, "考试核心"),
    ("discriminate", "歧视；区别", 3, "考试核心"),
    ("disperse", "分散", 3, "考试核心"),
    ("dispose", "处置", 3, "考试核心"),
    ("distort", "扭曲", 3, "考试核心"),
    ("diverse", "多样的", 3, "考试核心"),
    ("domain", "领域", 3, "考试核心"),
    ("domestic", "国内的；家庭的", 3, "考试核心"),
    ("dominant", "占主导地位的", 3, "考试核心"),
    ("elaborate", "详细阐述", 3, "考试核心"),
    ("eliminate", "消除", 3, "考试核心"),
    ("embody", "体现", 3, "考试核心"),
    ("emerge", "出现", 3, "考试核心"),
    ("empirical", "经验主义的", 3, "考试核心"),
    ("enforce", "执行；强制", 3, "考试核心"),
    ("enhance", "增强", 3, "考试核心"),
    ("equivalent", "等价的", 3, "考试核心"),
    ("erode", "侵蚀", 3, "考试核心"),
    ("ethical", "道德的", 3, "考试核心"),
    ("evaluate", "评估", 3, "考试核心"),
    ("evoke", "唤起", 3, "考试核心"),
    ("evolve", "进化", 3, "考试核心"),
    ("exclude", "排除", 3, "考试核心"),
    ("exhibit", "展示", 3, "考试核心"),
    ("explicit", "明确的", 3, "考试核心"),
    ("exploit", "开发；利用", 3, "考试核心"),
    ("facilitate", "促进", 3, "考试核心"),
    ("fluctuate", "波动", 3, "考试核心"),
    ("formulate", "制定", 3, "考试核心"),
    ("framework", "框架", 3, "考试核心"),
    ("fundamental", "基本的", 3, "考试核心"),
    ("generate", "产生", 3, "考试核心"),
    ("hypothesis", "假设", 3, "考试核心"),
    ("identical", "相同的", 3, "考试核心"),
    ("ideology", "意识形态", 3, "考试核心"),
    ("implement", "实施", 3, "考试核心"),
    ("implicit", "含蓄的", 3, "考试核心"),
    ("incorporate", "合并；包含", 3, "考试核心"),
    ("inevitable", "不可避免的", 3, "考试核心"),
    ("infrastructure", "基础设施", 3, "考试核心"),
    ("inherent", "固有的", 3, "考试核心"),
    ("inhibit", "抑制", 3, "考试核心"),
    ("innovate", "创新", 3, "考试核心"),
    ("integral", "不可或缺的", 3, "考试核心"),
    ("interpret", "解释", 3, "考试核心"),
    ("intervene", "干预", 3, "考试核心"),
    ("intrinsic", "内在的", 3, "考试核心"),
    ("invoke", "调用；祈求", 3, "考试核心"),
]

def init_database():
    """初始化数据库"""
    print("开始初始化数据库...")
    
    # 创建所有表
    Base.metadata.create_all(bind=engine)
    print("数据表创建成功！")
    
    # 创建会话
    db = SessionLocal()
    
    try:
        # 检查是否已有数据
        existing_count = db.query(Word).count()
        if existing_count > 0:
            print(f"数据库已存在 {existing_count} 个单词，跳过初始化。")
            return
        
        # 批量插入单词
        words = []
        for word_text, zh_def, difficulty, category in INITIAL_WORDS:
            word = Word(
                word=word_text,
                zh_definition=zh_def,
                difficulty=difficulty,
                category=category
            )
            words.append(word)
        
        db.bulk_save_objects(words)
        db.commit()
        
        print(f"成功插入 {len(INITIAL_WORDS)} 个单词！")
        
        # 统计各难度单词数
        for diff in [1, 2, 3]:
            count = db.query(Word).filter(Word.difficulty == diff).count()
            print(f"难度{diff}: {count}个单词")
        
        # 统计各分类单词数
        categories = db.query(Word.category).distinct().all()
        for (cat,) in categories:
            count = db.query(Word).filter(Word.category == cat).count()
            print(f"{cat}: {count}个单词")
        
    except Exception as e:
        print(f"初始化失败: {e}")
        db.rollback()
    finally:
        db.close()
    
    print("数据库初始化完成！")

if __name__ == "__main__":
    init_database()
