name: CI/CD

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test-backend:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ['3.8', '3.9', '3.10']

    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
    
    - name: Install dependencies
      working-directory: ./backend
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Check Python syntax
      working-directory: ./backend
      run: |
        python -m py_compile app/*.py

  build-frontend:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: Install dependencies
      working-directory: ./frontend
      run: npm install
    
    - name: Build
      working-directory: ./frontend
      run: npm run build
      
    - name: Upload build artifacts
      uses: actions/upload-artifact@v3
      with:
        name: frontend-build
        path: frontend/dist

  check-structure:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Check required files
      run: |
        test -f README.md || exit 1
        test -f LICENSE || exit 1
        test -f backend/requirements.txt || exit 1
        test -f frontend/package.json || exit 1
        echo "All required files present!"
    
    - name: Check backend structure
      run: |
        test -d backend/app || exit 1
        test -f backend/app/main.py || exit 1
        test -f backend/app/models.py || exit 1
        echo "Backend structure valid!"
    
    - name: Check frontend structure
      run: |
        test -d frontend/src || exit 1
        test -f frontend/src/main.js || exit 1
        test -d frontend/src/components || exit 1
        echo "Frontend structure valid!"
